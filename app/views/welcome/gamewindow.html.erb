<!doctype html>
<html lang="en">
<head>
<title>Exploding Kittens</title>

<script type="text/javascript">

var cards =
  ['attack-1','attack-2','attack-3','attack-4','cat-1','cat-2','cat-3','cat-4',
   'cat-5','cat-6','defuse-1','defuse-2','defuse-3','defuse-4','defuse-5',
   'exploding-kitten-1','exploding-kitten-2','exploding-kitten-3','favor-1',
   'favor-2','future-1','future-2','future-3','nope-1','nope-2','shuffle-1',
   'shuffle-2','shuffle-3','skip-1','skip-2'];

$(document).ready(function() {
  // cards can be drawn from deck
  $('#deck').click( function() {
    spawn_card();
  });

  // discard pile is droppable
  $('#discard').droppable( {
    accept: '.draggable-card',
    hoverClass: 'hovered',
    drop: handleDropEvent
  });

  $('.draggable-card').draggable( {
    cursor: 'move',
    snap: '#discard',
    containment: '#game-window',
    stack: '.draggable-card'
  });

  $('#game-window').on('click', '.draggable-card', function() {
    $(this).animate({
      height: ($(this).height() == 400) ? 200 : 400,
      width: ($(this).width() == 240) ? 120 : 240,
    }, 200);
  });
});

function handleDropEvent( event, ui ) {
  var draggable = ui.draggable;
  alert( 'Card "' + draggable.attr('id') + '" was discarded!' );
  draggable.remove();
}

function spawn_card() { 
  var img = document.createElement("img");
  var card_name = cards[Math.floor(Math.random()*cards.length)];
  img.src = "assets/" + card_name;
  img.setAttribute("class", "card draggable-card");
  img.setAttribute("id", card_name);
  document.getElementById('hand').appendChild(img);

  $(img).draggable( {
    cursor: 'move',
    snap: '#discard',
    containment: '#game-window',
    stack: '.draggable-card'
  });
  resizeHand();
}

function resizeHand() {
  var num_cards = $('.draggable-card').length;
  if (num_cards > 7) {
    //document.getElementById('hand').innerHTML = "<br>";
    //$('#hand').append('<br>');

  }
  
}

</script>
 
</head>

<body>

<div id="game-window" style="height: 750px;">

  <% cards =
  ['attack-1','attack-2','attack-3','attack-4','cat-1','cat-2','cat-3','cat-4',
   'cat-5','cat-6','defuse-1','defuse-2','defuse-3','defuse-4','defuse-5',
   'exploding-kitten-1','exploding-kitten-2','exploding-kitten-3','favor-1',
   'favor-2','future-1','future-2','future-3','nope-1','nope-2','shuffle-1',
   'shuffle-2','shuffle-3','skip-1','skip-2'] %>

  <div id="deck-discard">
    <div id="deck" class="card"><%=image_tag("deck.png")%></div>
    <div id="discard" class="card">Discard</div>
  </div>

  <div id="hand" class="cards">
    <% for i in 0...5 %>
      <% card = cards[i] %>
        <%= image_tag(card, :class => "card draggable-card", :id => card) %>
    <% end %>
  </div>

</div>

</body>
</html>
